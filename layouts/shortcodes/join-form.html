<form id="join-form" class="join-form" method="POST">
  <div class="form-group">
    <label for="name">Name</label>
    <input type="text" id="name" name="name" required>
  </div>

  <div class="form-group">
    <label for="email">Email</label>
    <input type="email" id="email" name="email" required>
  </div>

  <div class="form-group">
    <fieldset class="membership-type">
      <legend>Membership type</legend>
      <label class="radio-label">
        <input type="radio" name="membership" value="adult" required> Adult
      </label>
      <label class="radio-label">
        <input type="radio" name="membership" value="youth"> Youth
      </label>
    </fieldset>
  </div>

  <div class="form-group">
    <label class="checkbox-label">
      <input type="checkbox" id="consent" name="consent" required>
      <span>By filling out this form I am expressing my interest in becoming a member of WRECK'd and consent to my information being collected and retained for the purpose of processing this application.</span>
    </label>
  </div>

  <button type="submit">Submit</button>
  <div id="form-status" class="form-status"></div>
</form>

<script>
document.getElementById("join-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const status = document.getElementById("form-status");
  const btn = this.querySelector("button[type=submit]");

  btn.disabled = true;
  btn.textContent = "Submitting...";
  status.textContent = "";
  status.className = "form-status";

  const formData = new FormData(this);
  const data = {
    name: formData.get("name"),
    email: formData.get("email"),
    membership: formData.get("membership"),
  };

  try {
    const resp = await fetch("{{ .Get "action" }}", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });
    const result = await resp.json();
    if (resp.ok) {
      status.textContent = "Thanks for signing up! We'll be in touch.";
      status.className = "form-status success";
      this.reset();
    } else {
      status.textContent = result.error || "Something went wrong. Please try again.";
      status.className = "form-status error";
    }
  } catch (err) {
    status.textContent = "Network error. Please try again.";
    status.className = "form-status error";
  }

  btn.disabled = false;
  btn.textContent = "Submit";
});
</script>
